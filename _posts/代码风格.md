---
title: 代码风格
date: 2020-11-17 21:52:36
tags:
  - GoF
---
## 类、函数多大才合适？
总体上来讲，**类或函数的代码行数不能太多，但也不能太少**。类或函数的代码行数太多，一个类上千行，一个函数几百行，逻辑过于繁杂，阅读代码的时候，很容易就会看了后面忘了前面。相反，类或函数的代码行数太少，在代码总量相同的情况下，被分割成的类和函数就会相应增多，调用关系就会变得更复杂，阅读某个代码逻辑的时候，需要频繁地在 n 多类或者 n 多函数之间跳来跳去，阅读体验也不好。

对于函数代码行数的最大限制，网上有一种说法，那就是**不要超过一个显示屏的垂直高度**。比如，在我的电脑上，如果要让一个函数的代码完整地显示在 IDE 中，那最大代码行数不能超过 50。这个说法我觉得挺有道理的。因为超过一屏之后，在阅读代码的时候，为了串联前后的代码逻辑，就可能需要频繁地上下滚动屏幕，阅读体验不好不说，还容易出错。

对于类的代码行数的最大限制，这个就更难给出一个确切的值了。有一个间接的判断标准 -- 当一个类的代码读起来让你感觉头大了，实现某个功能时不知道该用哪个函数了，想用哪个函数翻半天都找不到了，只用到一个小功能要引入整个类（**类中包含很多无关此功能实现的函数**）的时候，这就说明类的行数过多了。

## 一行代码多长最合适？
不同的编程语言、不同的规范、不同的项目团队，对此的限制可能都不相同。不管这个限制是多少，总体上来讲我们要遵循的一个原则是：**一行代码最长不能超过 IDE 显示的宽度**。需要滚动鼠标才能查看一行的全部代码，显然不利于代码的阅读。当然，这个限制也不能太小，太小会导致很多稍长点的语句被折成两行，也会影响到代码的整洁，不利于阅读。
<!--more-->

## 善用空行分割单元块
对于比较长的函数，如果逻辑上可以分为几个独立的代码块，在不方便将这些独立的代码块抽取成小函数的情况下，为了让逻辑更加清晰，**除了用总结性注释的方法之外，我们还可以使用空行来分割各个代码块**。

除此之外，在类的成员变量与函数之间、静态成员变量与普通成员变量之间、各函数之间、甚至各成员变量之间，我们都可以通过添加空行的方式，让这些不同模块的代码之间，界限更加明确。**写代码就类似写文章，善于应用空行**，可以让代码的整体结构看起来更加有清晰、有条理。

## 四格缩进还是两格缩进？
有一个选择的标准，那就是**跟业内推荐的风格统一、跟著名开源项目统一**。当我们需要拷贝一些开源的代码到项目里的时候，能够让引入的代码跟我们项目本身的代码，保持风格统一。

除此之外，值得强调的是，不管是用两格缩进还是四格缩进，**一定不要用 tab 键缩进**。因为在不同的 IDE 下，tab 键的显示宽度不同，有的显示为四格缩进，有的显示为两格缩进。

## 大括号是否要另起一行？
左大括号是否要另起一行呢？这个也有争论：
```java
// PHP
class ClassName
{
    public function foo()
    {
        // method body
    }
}

// Java
public class ClassName {
    public void foo() {
        // method body
    }
}
```

不过，还是那句话，大括号跟上一条语句在同一行，还是另起新的一行，只要团队统一、业内统一、跟开源项目看齐就好了，**没有绝对的优劣之分**。

## 类中成员的排列顺序
在 Java 类文件中，**先要书写类所属的包名，然后再罗列 import 引入的依赖类**。在 Google 编码规范中，**依赖类按照字母序从小到大排列**。

在类中，**成员变量排在函数的前面**。成员变量之间或函数之间，都是按照**先静态（静态函数或静态成员变量）、后普通（非静态函数或非静态成员变量）**的方式来排列的。除此之外，成员变量之间或函数之间，还会按照作用域范围从大到小的顺序来排列，**先写 public 成员变量或函数，然后是 protected 的，最后是 private 的**。

实际上，还有另外一种排列习惯，那就是**把有调用关系的函数放到一块**。比如，一个 public 函数调用了另外一个 private 函数，那就把这两者放到一块。
