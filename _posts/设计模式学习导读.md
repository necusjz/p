---
title: 设计模式学习导读
tags:
  - GoF
abbrlink: 776702450
date: 2020-08-20 11:54:14
---
> 如果说数据结构和算法是教你如何写出高效代码，那设计模式讲的是如何写出可扩展、可读、可维护的高质量代码。

优秀的开源项目、框架、中间件，代码量、类的个数都会比较多，类结构、类之间的关系极其复杂，常常调用来调用去。所以，为了保证代码的扩展性、灵活性、可维护性等，代码中会使用到很多设计模式、设计原则或者设计思想。如果你不懂这些设计模式、原则、思想，在看代码的时候，你可能就会琢磨不透作者的设计思路，对于一些很明显的设计思路，你可能要花费很多时间才能参悟。相反，**如果你对设计模式、原则、思想非常了解，一眼就能参透作者的设计思路、设计初衷**，很快就可以把脑容量释放出来，重点思考其他问题，代码读起来就会变得轻松了。

## 代码质量评价标准
仔细看前面罗列的所有代码质量评价标准，你会发现，有些词语过于笼统、抽象，比较偏向对于整体的描述，比如优雅、好、坏、整洁、清晰等；有些过于细节、偏重方法论，比如模块化、高内聚低耦合、文档详尽、分层清晰等；有些可能并不仅仅局限于编码，跟架构设计等也有关系，比如可伸缩性、可用性、稳定性等。要写出满足这些评价标准的高质量代码，我们**需要掌握一些更加细化、更加能落地的编程方法论**，包括面向对象设计思想、设计原则、设计模式、编程规范、重构技巧等。而所有这些编程方法论的最终目的都是为了编写出高质量的代码。

![](https://raw.githubusercontent.com/necusjz/p/master/GoF/04.png)
<!--more-->

### 可维护性（Maintainability）
所以，从正面去分析一个代码是否易维护稍微有点难度。不过，我们可以从侧面上给出一个比较主观但又比较准确的感受。如果 bug 容易修复，修改、添加功能能够轻松完成，那我们就可以主观地认为代码对我们来说易维护。相反，如果修改一个 bug，修改、添加一个功能，需要花费很长的时间，那我们就可以主观地认为代码对我们来说不易维护。

### 可读性（Readability）
> Any fool can write code that a computer can understand. Good programmers write code that humans can understand. -- Martin Fowler

实际上，code review 是一个很好的测验代码可读性的手段。如果你的同事可以轻松地读懂你写的代码，那说明你的代码可读性很好；如果同事在读你的代码时，有很多疑问，那就说明你的代码可读性有待提高了。

### 可扩展性（Extensibility）
代码的可扩展性表示，我们在不修改或少量修改原有代码的情况下，通过扩展的方式添加新的功能代码。说直白点就是，代码预留了一些功能扩展点，你可以把新功能代码，直接插到扩展点上，而不需要因为要添加一个功能而大动干戈，改动大量的原始代码。

### 灵活性（Flexibility）
从刚刚举的场景来看，如果一段代码易扩展、易复用或者易用，我们都可以称这段代码写得比较灵活。所以，灵活这个词的含义非常宽泛，很多场景下都可以使用。

### 简洁性（Simplicity）
不过，很多编程经验不足的程序员会觉得，简单的代码没有技术含量，喜欢在项目中引入一些复杂的设计模式，觉得这样才能体现自己的技术水平。实际上，思从深而行从简，真正的高手能云淡风轻地用最简单的方法解决最复杂的问题。这也是一个编程老手跟编程新手的本质区别之一。

### 可复用性（Reusability）
比如，当讲到面向对象特性的时候，我们会讲到继承、多态存在的目的之一，就是为了提高代码的可复用性；当讲到设计原则的时候，我们会讲到单一职责原则也跟代码的可复用性相关；当讲到重构技巧的时候，我们会讲到解耦、高内聚、模块化等都能提高代码的可复用性。可见，可复用性也是一个非常重要的代码评价标准，是很多设计原则、思想、模式等所要达到的最终效果。

### 可测试性（Testability）
相对于前面六个评价标准，代码的可测试性是一个相对较少被提及，但又非常重要的代码质量评价标准。代码可测试性的好坏，能从侧面上非常准确地反应代码质量的好坏。代码的可测试性差，比较难写单元测试，那基本上就能说明代码设计得有问题。关于代码的可测试性，我们在重构那一部分，会花两节课的时间来详细讲解。现在，你暂时只需要知道，代码的可测试性非常重要就可以了。

## 面向对象
现在，主流的编程范式或者是编程风格有三种，它们分别是**面向过程、面向对象和函数式编程**。面向对象这种编程风格又是这其中最主流的。现在比较流行的编程语言大部分都是面向对象编程语言。大部分项目也都是基于面向对象编程风格开发的。面向对象编程因为其具有丰富的特性（封装、抽象、继承、多态），可以实现很多复杂的设计思路，是很多设计原则、设计模式编码实现的基础。

几大知识点：
- 面向对象的四大特性：封装、抽象、继承、多态；
- 面向对象编程与面向过程编程的区别和联系；
- 面向对象分析、面向对象设计、面向对象编程；
- 接口和抽象类的区别以及各自的应用场景；
- 基于接口而非实现编程的设计思想；
- 多用组合少用继承的设计思想；
- 面向过程的贫血模型和面向对象的充血模型；

![](https://raw.githubusercontent.com/necusjz/p/master/GoF/05.png)

## 设计原则
设计原则是指导我们代码设计的一些经验总结。设计原则这块儿的知识有一个非常大的特点，那就是这些原则听起来都比较抽象，定义描述都比较模糊，不同的人会有不同的解读。所以，如果单纯地去记忆定义，对于编程、设计能力的提高，意义并不大。对于每一种设计原则，我们**需要掌握它的设计初衷，能解决哪些编程问题，有哪些应用场景**。只有这样，我们才能在项目中灵活恰当地应用这些原则。

几个常用的设计原则：
- SRP 单一职责原则；
- OCP 开闭原则；
- LSP 里式替换原则；
- ISP 接口隔离原则；
- DIP 依赖倒置原则；
- DRY 原则、KISS 原则、YAGNI 原则、LoD 法则；

![](https://raw.githubusercontent.com/necusjz/p/master/GoF/06.png)

## 规范与重构
**编程规范主要解决的是代码的可读性问题**。编程规范相对于设计原则、设计模式，更加具体、更加偏重代码细节。即便你可能对设计原则不熟悉、对设计模式不了解，但你最起码要掌握基本的编码规范，比如，如何给变量、类、函数命名，如何写代码注释，函数不宜过长、参数不能过多等等。

在软件开发中，只要软件在不停地迭代，就没有一劳永逸的设计。随着需求的变化，代码的不停堆砌，原有的设计必定会存在这样那样的问题。针对这些问题，我们就需要进行代码重构。重构是软件开发中非常重要的一个环节。**持续重构是保持代码质量不下降的有效手段**，能有效避免代码腐化到无可救药的地步。

几个知识点：
- 重构的目的（why）、对象（what）、时机（when）、方法（how）；
- 保证重构不出错的技术手段：单元测试和代码的可测试性；
- 大重构（大规模高层次）；
- 小重构（小规模低层次）；

![](https://raw.githubusercontent.com/necusjz/p/master/GoF/07.png)

## 设计模式
设计模式是针对软件开发中经常遇到的一些设计问题，总结出来的一套解决方案或者设计思路。**大部分设计模式要解决的都是代码的可扩展性问题**。设计模式相对于设计原则来说，没有那么抽象，而且大部分都不难理解，代码实现也并不复杂。这一块的学习难点是了解它们都能解决哪些问题，掌握典型的应用场景，并且懂得不过度应用。

### 创建型
创建型设计模式主要解决“对象的创建”问题：
- 常用：单例模式、工厂模式、建造者模式；
- 不常用：原型模式；

### 结构型
结构型设计模式主要解决“类或对象的组合或组装”问题：
- 常用：代理模式、桥接模式、装饰者模式、适配器模式；
- 不常用：门面模式、组合模式、享元模式；

### 行为型
行为型设计模式主要解决“类或对象之间的交互”问题：
- 常用：观察者模式、模板模式、策略模式、职责链模式、迭代器模式、状态模式；
- 不常用：访问者模式、备忘录模式、命令模式、解释器模式、中介模式；
